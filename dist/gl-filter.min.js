var GLFilter=function(){"use strict";function g(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"rgba(0, 0, 0, 0)";return Array.isArray(t)&&(t={r:t[0],g:t[1],b:t[2],a:t[3]}),"hex"==e?n(t):"rgb"==e?i(t,r):"hsl"==e?o(t):t}function n(t){var e=(t=Array.isArray(t)?{r:t[0],g:t[1],b:t[2],a:t[3]}:t).r.toString(16);t.r<16&&(e="0"+e);var r=t.g.toString(16);t.g<16&&(r="0"+r);var n=t.b.toString(16);t.b<16&&(n="0"+n);var i="";return t.a<1&&(i=(t=Math.floor(255*t.a)).toString(16),t<16&&(i="0"+i)),"#"+e+r+n+i}function i(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"rgba(0, 0, 0, 0)";if(void 0!==(t=Array.isArray(t)?{r:t[0],g:t[1],b:t[2],a:t[3]}:t))return 1==t.a||void 0===t.a?isNaN(t.r)?e:"rgb("+t.r+","+t.g+","+t.b+")":"rgba("+t.r+","+t.g+","+t.b+","+t.a+")"}function o(t){return 1==(t=Array.isArray(t)?{r:t[0],g:t[1],b:t[2],a:t[3]}:t).a||void 0===t.a?"hsl("+t.h+","+t.s+"%,"+t.l+"%)":"hsla("+t.h+","+t.s+"%,"+t.l+"%,"+t.a+")"}var t={format:g,rgb:i,hsl:o,hex:n};function h(t,e){return e=void 0===e?1:e,Math.round(t*e)/e}function r(t){return t*Math.PI/180}function a(t){t=180*t/Math.PI;return t=t<0?360+t:t}var e={round:h,radianToDegree:a,degreeToRadian:r,getXInCircle:function(t,e){return(2<arguments.length&&void 0!==arguments[2]?arguments[2]:0)+e*Math.cos(r(t))},getYInCircle:function(t,e){return(2<arguments.length&&void 0!==arguments[2]?arguments[2]:0)+e*Math.sin(r(t))},caculateAngle:function(t,e){return a(Math.atan2(e,t))}},l={aliceblue:"rgb(240, 248, 255)",antiquewhite:"rgb(250, 235, 215)",aqua:"rgb(0, 255, 255)",aquamarine:"rgb(127, 255, 212)",azure:"rgb(240, 255, 255)",beige:"rgb(245, 245, 220)",bisque:"rgb(255, 228, 196)",black:"rgb(0, 0, 0)",blanchedalmond:"rgb(255, 235, 205)",blue:"rgb(0, 0, 255)",blueviolet:"rgb(138, 43, 226)",brown:"rgb(165, 42, 42)",burlywood:"rgb(222, 184, 135)",cadetblue:"rgb(95, 158, 160)",chartreuse:"rgb(127, 255, 0)",chocolate:"rgb(210, 105, 30)",coral:"rgb(255, 127, 80)",cornflowerblue:"rgb(100, 149, 237)",cornsilk:"rgb(255, 248, 220)",crimson:"rgb(237, 20, 61)",cyan:"rgb(0, 255, 255)",darkblue:"rgb(0, 0, 139)",darkcyan:"rgb(0, 139, 139)",darkgoldenrod:"rgb(184, 134, 11)",darkgray:"rgb(169, 169, 169)",darkgrey:"rgb(169, 169, 169)",darkgreen:"rgb(0, 100, 0)",darkkhaki:"rgb(189, 183, 107)",darkmagenta:"rgb(139, 0, 139)",darkolivegreen:"rgb(85, 107, 47)",darkorange:"rgb(255, 140, 0)",darkorchid:"rgb(153, 50, 204)",darkred:"rgb(139, 0, 0)",darksalmon:"rgb(233, 150, 122)",darkseagreen:"rgb(143, 188, 143)",darkslateblue:"rgb(72, 61, 139)",darkslategray:"rgb(47, 79, 79)",darkslategrey:"rgb(47, 79, 79)",darkturquoise:"rgb(0, 206, 209)",darkviolet:"rgb(148, 0, 211)",deeppink:"rgb(255, 20, 147)",deepskyblue:"rgb(0, 191, 255)",dimgray:"rgb(105, 105, 105)",dimgrey:"rgb(105, 105, 105)",dodgerblue:"rgb(30, 144, 255)",firebrick:"rgb(178, 34, 34)",floralwhite:"rgb(255, 250, 240)",forestgreen:"rgb(34, 139, 34)",fuchsia:"rgb(255, 0, 255)",gainsboro:"rgb(220, 220, 220)",ghostwhite:"rgb(248, 248, 255)",gold:"rgb(255, 215, 0)",goldenrod:"rgb(218, 165, 32)",gray:"rgb(128, 128, 128)",grey:"rgb(128, 128, 128)",green:"rgb(0, 128, 0)",greenyellow:"rgb(173, 255, 47)",honeydew:"rgb(240, 255, 240)",hotpink:"rgb(255, 105, 180)",indianred:"rgb(205, 92, 92)",indigo:"rgb(75, 0, 130)",ivory:"rgb(255, 255, 240)",khaki:"rgb(240, 230, 140)",lavender:"rgb(230, 230, 250)",lavenderblush:"rgb(255, 240, 245)",lawngreen:"rgb(124, 252, 0)",lemonchiffon:"rgb(255, 250, 205)",lightblue:"rgb(173, 216, 230)",lightcoral:"rgb(240, 128, 128)",lightcyan:"rgb(224, 255, 255)",lightgoldenrodyellow:"rgb(250, 250, 210)",lightgreen:"rgb(144, 238, 144)",lightgray:"rgb(211, 211, 211)",lightgrey:"rgb(211, 211, 211)",lightpink:"rgb(255, 182, 193)",lightsalmon:"rgb(255, 160, 122)",lightseagreen:"rgb(32, 178, 170)",lightskyblue:"rgb(135, 206, 250)",lightslategray:"rgb(119, 136, 153)",lightslategrey:"rgb(119, 136, 153)",lightsteelblue:"rgb(176, 196, 222)",lightyellow:"rgb(255, 255, 224)",lime:"rgb(0, 255, 0)",limegreen:"rgb(50, 205, 50)",linen:"rgb(250, 240, 230)",magenta:"rgb(255, 0, 255)",maroon:"rgb(128, 0, 0)",mediumaquamarine:"rgb(102, 205, 170)",mediumblue:"rgb(0, 0, 205)",mediumorchid:"rgb(186, 85, 211)",mediumpurple:"rgb(147, 112, 219)",mediumseagreen:"rgb(60, 179, 113)",mediumslateblue:"rgb(123, 104, 238)",mediumspringgreen:"rgb(0, 250, 154)",mediumturquoise:"rgb(72, 209, 204)",mediumvioletred:"rgb(199, 21, 133)",midnightblue:"rgb(25, 25, 112)",mintcream:"rgb(245, 255, 250)",mistyrose:"rgb(255, 228, 225)",moccasin:"rgb(255, 228, 181)",navajowhite:"rgb(255, 222, 173)",navy:"rgb(0, 0, 128)",oldlace:"rgb(253, 245, 230)",olive:"rgb(128, 128, 0)",olivedrab:"rgb(107, 142, 35)",orange:"rgb(255, 165, 0)",orangered:"rgb(255, 69, 0)",orchid:"rgb(218, 112, 214)",palegoldenrod:"rgb(238, 232, 170)",palegreen:"rgb(152, 251, 152)",paleturquoise:"rgb(175, 238, 238)",palevioletred:"rgb(219, 112, 147)",papayawhip:"rgb(255, 239, 213)",peachpuff:"rgb(255, 218, 185)",peru:"rgb(205, 133, 63)",pink:"rgb(255, 192, 203)",plum:"rgb(221, 160, 221)",powderblue:"rgb(176, 224, 230)",purple:"rgb(128, 0, 128)",rebeccapurple:"rgb(102, 51, 153)",red:"rgb(255, 0, 0)",rosybrown:"rgb(188, 143, 143)",royalblue:"rgb(65, 105, 225)",saddlebrown:"rgb(139, 69, 19)",salmon:"rgb(250, 128, 114)",sandybrown:"rgb(244, 164, 96)",seagreen:"rgb(46, 139, 87)",seashell:"rgb(255, 245, 238)",sienna:"rgb(160, 82, 45)",silver:"rgb(192, 192, 192)",skyblue:"rgb(135, 206, 235)",slateblue:"rgb(106, 90, 205)",slategray:"rgb(112, 128, 144)",slategrey:"rgb(112, 128, 144)",snow:"rgb(255, 250, 250)",springgreen:"rgb(0, 255, 127)",steelblue:"rgb(70, 130, 180)",tan:"rgb(210, 180, 140)",teal:"rgb(0, 128, 128)",thistle:"rgb(216, 191, 216)",tomato:"rgb(255, 99, 71)",turquoise:"rgb(64, 224, 208)",violet:"rgb(238, 130, 238)",wheat:"rgb(245, 222, 179)",white:"rgb(255, 255, 255)",whitesmoke:"rgb(245, 245, 245)",yellow:"rgb(255, 255, 0)",yellowgreen:"rgb(154, 205, 50)",transparent:"rgba(0, 0, 0, 0)"};var u={isColorName:function(t){return!!l[t]},getColorByName:function(t){return l[t]}};function c(t,e,r){return r<0&&(r+=1),1<r&&--r,r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+(e-t)*(2/3-r)*6:t}function f(t,e,r){var n,i,o,a;return 1==arguments.length&&(t=(n=arguments[0]).h,e=n.s,r=n.l),t/=360,r/=100,0==(e/=100)?i=o=a=r:(i=c(e=2*r-(r=r<.5?r*(1+e):r+e-r*e),r,t+1/3),o=c(e,r,t),a=c(e,r,t-1/3)),{r:h(255*i),g:h(255*o),b:h(255*a)}}var s={HUEtoRGB:c,HSLtoHSV:function(t,e,r){var n;return 1==arguments.length&&(t=(n=arguments[0]).h,e=n.s,r=n.l),$((r=f(t,e,r)).r,r.g,r.b)},HSLtoRGB:f},v=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},d=function(t,e,r){return e&&p(t.prototype,e),r&&p(t,r),t};function p(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function b(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var x=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r,n=arguments[e];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},m=function(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)},y=/(#(?:[\da-f]{8})|#(?:[\da-f]{3}){1,2}|rgb\((?:\s*\d{1,3},\s*){2}\d{1,3}\s*\)|rgba\((?:\s*\d{1,3},\s*){3}\d*\.?\d+\s*\)|hsl\(\s*\d{1,3}(?:,\s*\d{1,3}%){2}\s*\)|hsla\(\s*\d{1,3}(?:,\s*\d{1,3}%){2},\s*\d*\.?\d+\s*\)|([\w_\-]+))/gi;function w(r){var t=r.match(y),e=[];if(!t)return e;for(var n,i=0,o=t.length;i<o;i++)-1<t[i].indexOf("#")||-1<t[i].indexOf("rgb")||-1<t[i].indexOf("hsl")?e.push({color:t[i]}):(n=u.getColorByName(t[i]))&&e.push({color:t[i],nameColor:n});var a={next:0};return e.forEach(function(t){var e=r.indexOf(t.color,a.next);t.startIndex=e,t.endIndex=e+t.color.length,a.next=t.endIndex}),e}function C(r){var t=w(r);return t.forEach(function(t,e){r=r.replace(t.color,"@"+e)}),{str:r,matches:t}}function k(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:",",r=C(t);return r.str.split(e).map(function(t,e){return t=T(t),t=r.matches[e]?t.replace("@"+e,r.matches[e].color):t})}function _(r,t){return t.forEach(function(t,e){r=r.replace("@"+e,t.color)}),r}function T(t){return t.replace(/^\s+|\s+$/g,"")}function A(t){if("string"==typeof t){if(-1<(t=u.isColorName(t)?u.getColorByName(t):t).indexOf("rgb(")){for(var e=0,r=(i=t.replace("rgb(","").replace(")","").split(",")).length;e<r;e++)i[e]=parseInt(T(i[e]),10);var n={type:"rgb",r:i[0],g:i[1],b:i[2],a:1};return n=Object.assign(n,R(n))}if(-1<t.indexOf("rgba(")){for(e=0,r=(i=t.replace("rgba(","").replace(")","").split(",")).length;e<r;e++)i[e]=r-1==e?parseFloat(T(i[e])):parseInt(T(i[e]),10);n={type:"rgb",r:i[0],g:i[1],b:i[2],a:i[3]};return n=Object.assign(n,R(n))}if(-1<t.indexOf("hsl(")){for(e=0,r=(i=t.replace("hsl(","").replace(")","").split(",")).length;e<r;e++)i[e]=parseFloat(T(i[e]));n={type:"hsl",h:i[0],s:i[1],l:i[2],a:1};return n=Object.assign(n,f(n))}if(-1<t.indexOf("hsla(")){for(e=0,r=(i=t.replace("hsla(","").replace(")","").split(",")).length;e<r;e++)i[e]=r-1==e?parseFloat(T(i[e])):parseInt(T(i[e]),10);n={type:"hsl",h:i[0],s:i[1],l:i[2],a:i[3]};return n=Object.assign(n,f(n))}if(0==t.indexOf("#")){var i=[],o=1;if(3==(t=t.replace("#","")).length)for(e=0,r=t.length;e<r;e++){var a=t.substr(e,1);i.push(parseInt(a+a,16))}else if(8===t.length){for(e=0,r=t.length;e<r;e+=2)i.push(parseInt(t.substr(e,2),16));o=i.pop()/255}else for(e=0,r=t.length;e<r;e+=2)i.push(parseInt(t.substr(e,2),16));n={type:"hex",r:i[0],g:i[1],b:i[2],a:o};return n=Object.assign(n,R(n))}}else if("number"==typeof t){if(0<=t&&t<=16777215){n={type:"hex",r:(16711680&t)>>16,g:(65280&t)>>8,b:(255&t)>>0,a:1};return n=Object.assign(n,R(n))}if(0<=t&&t<=4294967295){n={type:"hex",r:(4278190080&t)>>24,g:(16711680&t)>>16,b:(65280&t)>>8,a:(255&t)/255};return n=Object.assign(n,R(n))}}return t}function M(r){var n,t=(r=(r="string"==typeof r?k(r):r).map(function(t){if("string"==typeof t){var e=C(t),r=T(e.str).split(" ");return r[1]?r[1].includes("%")?r[1]=parseFloat(r[1].replace(/%/,""))/100:r[1]=parseFloat(r[1]):r[1]="*",r[0]=_(r[0],e.matches),r}if(Array.isArray(t))return t[1]?"string"==typeof t[1]&&(t[1].includes("%")?t[1]=parseFloat(t[1].replace(/%/,""))/100:t[1]=+t[1]):t[1]="*",[].concat(m(t))})).filter(function(t){return"*"===t[1]}).length;return 0<t&&(n=(1-r.filter(function(t){return"*"!=t[1]&&1!=t[1]}).map(function(t){return t[1]}).reduce(function(t,e){return t+e},0))/t,r.forEach(function(t,e){"*"==t[1]&&0<e&&(r.length-1==e||(t[1]=n))})),r}var E={matches:w,convertMatches:C,convertMatchesArray:k,reverseMatches:_,parse:A,parseGradient:M,trim:T,color_regexp:y,color_split:","};function $(t,e,r){1==arguments.length&&(t=(o=arguments[0]).r,e=o.g,r=o.b);var n=t/255,i=e/255,o=r/255,t=Math.max(n,i,o),e=t-Math.min(n,i,o),r=0;0==e?r=0:t==n?r=(i-o)/e%6*60:t==i?r=60*((o-n)/e+2):t==o&&(r=60*((n-i)/e+4));return{h:r=r<0?360+r:r,s:0==t?0:e/t,v:t}}function R(t,e,r){1==arguments.length&&(t=(a=arguments[0]).r,e=a.g,r=a.b),t/=255,e/=255,r/=255;var n,i=Math.max(t,e,r),o=Math.min(t,e,r),a=(i+o)/2;if(i==o)n=u=0;else{var l=i-o,u=.5<a?l/(2-i-o):l/(i+o);switch(i){case t:n=(e-r)/l+(e<r?6:0);break;case e:n=(r-t)/l+2;break;case r:n=(t-e)/l+4}n/=6}return{h:h(360*n),s:h(100*u),l:h(100*a)}}function I(t){return{r:t,g:t,b:t}}function B(t,e,r){return Math.ceil(.2126*t+.7152*e+.0722*r)}function S(t,e,r){var n;1==arguments.length&&(t=(n=arguments[0]).r,e=n.g,r=n.b);e=B(t,e,r);return{y:e,cr:.713*(t-e),cb:.564*(r-e)}}function F(t,e){return 100*((1<arguments.length&&void 0!==e?e:.04045)<t?Math.pow((t+.055)/1.055,2.4):t/12.92)}function O(t,e,r){var n;1==arguments.length&&(t=(n=arguments[0]).r,e=n.g,r=n.b);e/=255,r/=255;return{x:.4124*(t=F(t=t/255))+.3576*(e=F(e))+.1805*(r=F(r)),y:.2126*t+.7152*e+.0722*r,z:.0193*t+.1192*e+.9505*r}}var U={RGBtoCMYK:function(t,e,r){1==arguments.length&&(t=(n=arguments[0]).r,e=n.g,r=n.b);var n=t/255,t=e/255,e=r/255,r=1-Math.max(n,t,e);return{c:(1-n-r)/(1-r),m:(1-t-r)/(1-r),y:(1-e-r)/(1-r),k:r}},RGBtoGray:function(t,e,r){var n;return 1==arguments.length&&(t=(n=arguments[0]).r,e=n.g,r=n.b),I(S(t,e,r).y)},RGBtoHSL:R,RGBtoHSV:$,RGBtoLAB:function(t,e,r){var n;return 1==arguments.length&&(t=(n=arguments[0]).r,e=n.g,r=n.b),XYZtoLAB(O(t,e,r))},RGBtoSimpleGray:function(t,e,r){var n;return 1==arguments.length&&(t=(n=arguments[0]).r,e=n.g,r=n.b),I(Math.ceil((t+e+r)/3))},RGBtoXYZ:O,RGBtoYCrCb:S,c:function(t,e,r){var n;return 1==arguments.length&&(t=(n=arguments[0]).r,e=n.g,r=n.b),I(90<(t+e+r)/3?0:255)},brightness:B,gray:I};var P={CMYKtoRGB:function(t,e,r,n){var i;return 1==arguments.length&&(t=(i=arguments[0]).c,e=i.m,r=i.y,n=i.k),{r:255*(1-t)*(1-n),g:255*(1-e)*(1-n),b:255*(1-r)*(1-n)}}};function G(t){return.008856<Math.pow(t,3)?Math.pow(t,3):(t-16/116)/7.787}function D(t){return.0031308<t?1.055*Math.pow(t,1/2.4)-.055:12.92*t}function L(t,e,r){1==arguments.length&&(t=(i=arguments[0]).x,e=i.y,r=i.z);var n=t/100,i=e/100,t=r/100,e=-.9689*n+1.8758*i+.0415*t,r=.0557*n+-.204*i+1.057*t,t=D(t=3.2406*n+-1.5372*i+-.4986*t),e=D(e),r=D(r);return{r:h(255*t),g:h(255*e),b:h(255*r)}}function j(t,e,r){var n;1==arguments.length&&(t=(n=arguments[0]).l,e=n.a,r=n.b);t=e/500+(e=(t+16)/116),r=e-r/200,e=G(e);return{x:95.047*(t=G(t)),y:100*e,z:108.883*(r=G(r))}}var N={XYZtoRGB:L,LABtoRGB:function(t,e,r){var n;return 1==arguments.length&&(t=(n=arguments[0]).l,e=n.a,r=n.b),L(j(t,e,r))},LABtoXYZ:j};function H(t,e,r){1==arguments.length&&(t=(i=arguments[0]).h,e=i.s,r=i.v);var n=t,i=r;360<=n&&(n=0);t=e*i,r=t*(1-Math.abs(n/60%2-1)),e=i-t,i=[];return 0<=n&&n<60?i=[t,r,0]:60<=n&&n<120?i=[r,t,0]:120<=n&&n<180?i=[0,t,r]:180<=n&&n<240?i=[0,r,t]:240<=n&&n<300?i=[r,0,t]:300<=n&&n<360&&(i=[t,0,r]),{r:h(255*(i[0]+e)),g:h(255*(i[1]+e)),b:h(255*(i[2]+e))}}var X={HSVtoHSL:function(t,e,r){var n;return 1==arguments.length&&(t=(n=arguments[0]).h,e=n.s,r=n.v),R((r=H(t,e,r)).r,r.g,r.b)},HSVtoRGB:H};var z={YCrCbtoRGB:function(t,e,r,n){1==arguments.length&&(t=(i=arguments[0]).y,e=i.cr,r=i.cb,n=(n=i.bit)||0);var i=t-.344*(r-n)-.714*(e-n),r=t+1.772*(r-n);return{r:Math.ceil(t+1.402*(e-n)),g:Math.ceil(i),b:Math.ceil(r)}}};function q(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.5,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"hex",r={r:h(t.r+(e.r-t.r)*r),g:h(t.g+(e.g-t.g)*r),b:h(t.b+(e.b-t.b)*r),a:h(t.a+(e.a-t.a)*r,100)};return g(r,r.a<1?"rgb":n)}function Y(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:5;if(!t)return[];for(var r=(t=(t="string"==typeof t?k(t):t)||[]).length,n=[],i=0;i<r-1;i++)for(var o=0;o<e;o++)n.push(W(t[i],t[i+1],o/e));return n}function W(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.5,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"hex";return q(A(t),A(e),r,n)}function V(t){return t=A(t),(Math.round(299*t.r)+Math.round(587*t.g)+Math.round(114*t.b))/1e3}function K(t){for(var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"h",r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:9,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"rgb",i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:1,a=6<arguments.length&&void 0!==arguments[6]?arguments[6]:100,l=$(A(t)),u=(o-i)*a/r,h=[],c=1;c<=r;c++)l[e]=Math.abs((a-u*c)/a),h.push(g(H(l),n));return h}Y.parula=function(t){return Y(["#352a87","#0f5cdd","#00b5a6","#ffc337","#fdff00"],t)},Y.jet=function(t){return Y(["#00008f","#0020ff","#00ffff","#51ff77","#fdff00","#ff0000","#800000"],t)},Y.hsv=function(t){return Y(["#ff0000","#ffff00","#00ff00","#00ffff","#0000ff","#ff00ff","#ff0000"],t)},Y.hot=function(t){return Y(["#0b0000","#ff0000","#ffff00","#ffffff"],t)},Y.pink=function(t){return Y(["#1e0000","#bd7b7b","#e7e5b2","#ffffff"],t)},Y.bone=function(t){return Y(["#000000","#4a4a68","#a6c6c6","#ffffff"],t)},Y.copper=function(t){return Y(["#000000","#3d2618","#9d623e","#ffa167","#ffc77f"],t)};var Z={interpolateRGB:q,blend:W,mix:function(t,e){return W(t,e,2<arguments.length&&void 0!==arguments[2]?arguments[2]:.5,3<arguments.length&&void 0!==arguments[3]?arguments[3]:"hex")},scale:Y,contrast:V,contrastColor:function(t){return 128<=V(t)?"black":"white"},gradient:function(t){for(var e=[],r=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:10)-((t=M(t)).length-1),n=r,i=1,o=t.length;i<o;i++){var a=t[i-1][0],l=t[i][0],u=1==i?t[i][1]:t[i][1]-t[i-1][1],u=i==t.length-1?n:Math.floor(u*r),e=e.concat(Y([a,l],u),[l]);n-=u}return e},scaleHSV:K,scaleH:function(t){return K(t,"h",1<arguments.length&&void 0!==arguments[1]?arguments[1]:9,2<arguments.length&&void 0!==arguments[2]?arguments[2]:"rgb",3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,4<arguments.length&&void 0!==arguments[4]?arguments[4]:360,1)},scaleS:function(t){return K(t,"s",1<arguments.length&&void 0!==arguments[1]?arguments[1]:9,2<arguments.length&&void 0!==arguments[2]?arguments[2]:"rgb",3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,4<arguments.length&&void 0!==arguments[4]?arguments[4]:1,100)},scaleV:function(t){return K(t,"v",1<arguments.length&&void 0!==arguments[1]?arguments[1]:9,2<arguments.length&&void 0!==arguments[2]?arguments[2]:"rgb",3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,4<arguments.length&&void 0!==arguments[4]?arguments[4]:1,100)}};var J={euclidean:function(t,e){for(var r=0,n=0,i=t.length;n<i;n++)r+=Math.pow(e[n]-t[n],2);return Math.sqrt(r)},manhattan:function(t,e){for(var r=0,n=0,i=t.length;n<i;n++)r+=Math.abs(e[n]-t[n]);return r},max:function(t,e){for(var r=0,n=0,i=t.length;n<i;n++)r=Math.max(r,Math.abs(e[n]-t[n]));return r}},Q={linear:function(t,e){for(var r=[],n=Math.round(Math.random()*t),i=Math.floor(t/e);r.push(n),n=(n+i)%t,r.length<e;);return r},shuffle:function(t,e){for(var r=[];r.length<e;){var n=Math.round(Math.random()*t);-1==r.indexOf(n)&&r.push(n)}return r}};function tt(t,e,r,n){for(var i=new Array(t),o=0;o<t;o++)i[o]=[];for(var a=0,l=e.length;a<l;a++){var u=e[a];i[function(r,t,n){var i=1/0,o=0;return t.forEach(function(t,e){t=n(r,t);t<i&&(i=t,o=e)}),o}(u,r,n)].push(u)}return i}function et(t,e,r,n,i,o){for(var a=0;a<t;a++){var l=r[a],u=n[a],h=new Array(u.length);i=!function(t,e){if(t.length===e.length){for(var r=0,n=t.length;r<n;++r)if(t[r]!==e[r])return;return 1}}(h=0<l.length?function(t){if(!t.length)return[];for(var e=new Array(t[0].length),r=0,n=e.length;r<n;r++)e[r]=0;for(var i=0,n=t.length;i<n;i++)for(var o=t[i],a=i+1,l=0,u=o.length;l<u;l++)e[l]+=(o[l]-e[l])/a;return e=e.map(function(t){return Math.floor(t)})}(l):e[Math.floor(o()*e.length)],u),n[a]=h}return i}function rt(t,e,r,n,i){var o=3<arguments.length&&void 0!==n?n:10,i=4<arguments.length&&void 0!==i?i:"linear";t=t,e=e||Math.max(2,Math.ceil(Math.sqrt(t.length/2)));var a=r||"euclidean";"string"==typeof a&&(a=J[a]);for(var l=0,u=function(){return(l=(9301*l+49297)%233280)/233280},h=function(e,t,r){return Q[2<arguments.length&&void 0!==r?r:"linear"](e.length,t).map(function(t){return e[t]})}(t,e,i),c=!0,g=0;c;){c=et(e,t,tt(e,t,h,a),h,!1,u);if(++g%o==0)break}return h}function nt(e,r){!function(t,e){for(var r=0;r<t;r+=4)e(r)}(e.pixels.length,function(t){r(e.pixels,t)})}var it={create:function(t,e){var r=document.createElement("canvas");return r.width=t||0,r.height=e||0,r},drawPixels:function(t){var e=this.create(t.width,t.height),r=e.getContext("2d"),n=r.getImageData(0,0,e.width,e.height);return n.data.set(t.pixels),r.putImageData(n,0,0),e},createHistogram:function(i,o,a,t){var e=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{black:!0,red:!1,green:!1,blue:!1},r=this.create(i,o),l=r.getContext("2d");l.clearRect(0,0,i,o),l.fillStyle="white",l.fillRect(0,0,i,o);var u={black:!(l.globalAlpha=.7)};e.black?u.black=!1:u.black=!0,e.red?u.red=!1:u.red=!0,e.green?u.green=!1:u.green=!0,e.blue?u.blue=!1:u.blue=!0,Object.keys(a).forEach(function(t){var e,r,n;u[t]||(e=a[t],r=Math.max.apply(Math,e),n=i/e.length,l.fillStyle=t,e.forEach(function(t,e){t=o*(t/r);l.fillRect(e*n,o-t,n,t)}))}),"function"==typeof t&&t(r)},getHistogram:function(t){for(var n=new Array(256),i=new Array(256),o=new Array(256),a=new Array(256),e=0;e<256;e++)n[e]=0,i[e]=0,o[e]=0,a[e]=0;return nt(t,function(t,e){var r=Math.round(te.brightness(t[e],t[e+1],t[e+2]));n[r]++,i[t[e]]++,o[t[e+1]]++,a[t[e+2]]++}),{black:n,red:i,green:o,blue:a}},getBitmap:function(t,e){t=this.drawPixels(t);return{pixels:t.getContext("2d").getImageData(e.x||0,e.y||0,e.width||t.width,e.height||t.height).data,width:e.width,height:e.height}},putBitmap:function(t,e,r){var n=this.drawPixels(t),e=this.drawPixels(e),n=n.getContext("2d");return n.drawImage(e,r.x,r.y),t.pixels=n.getImageData(0,0,t.width,t.height).data,t}},ot=(d(at,[{key:"initialize",value:function(){this.canvas=this.createCanvas(),this.context=this.canvas.getContext("2d")}},{key:"createCanvas",value:function(){return document.createElement("canvas")}},{key:"load",value:function(t){this.loadImage(t)}},{key:"loadImage",value:function(e){var r=this,n=this.context;this.newImage=new Image;var i=this.newImage;i.onload=function(){var t=i.height/i.width;r.opt.canvasWidth&&r.opt.canvasHeight?(r.canvas.width=r.opt.canvasWidth,r.canvas.height=r.opt.canvasHeight):(r.canvas.width=r.opt.maxWidth||i.width,r.canvas.height=r.canvas.width*t),n.drawImage(i,0,0,i.width,i.height,0,0,r.canvas.width,r.canvas.height),r.isLoaded=!0,e&&e()},this.getImageUrl(function(t){i.src=t})}},{key:"load",value:function(t){var e=this;this.newImage=new Image;var r=this.newImage;r.onload=function(){e.isLoaded=!0,t&&t()},this.getImageUrl(function(t){r.src=t})}},{key:"getImageUrl",value:function(e){if("string"==typeof this.imageUrl)return e(this.imageUrl);var t;this.imageUrl instanceof Blob&&((t=new FileReader).onload=function(t){e(t.target.result)},t.readAsDataURL(this.imageUrl))}},{key:"getRGBA",value:function(t,e,r,n){return[t,e,r,n]}},{key:"toArray",value:function(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},n=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),i=n.width,o=n.height;(t=t||function(t,e){e(t)})({pixels:new Uint8ClampedArray(n.data),width:i,height:o},function(t){t=it.drawPixels(t);"canvas"==r.returnTo?e(t):e(t.toDataURL(r.outputFormat||"image/png"))},r)}},{key:"toHistogram",value:function(t){var e=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),r=e.width,n=e.height,e=new Uint8ClampedArray(e.data);return it.getHistogram({pixels:e,width:r,height:n})}},{key:"toRGB",value:function(){for(var t=this.context.getImageData(0,0,this.canvas.width,this.canvas.height).data,e=[],r=0,n=t.length;r<n;r+=4)e[e.length]=[t[r+0],t[r+1],t[r+2],t[r+3]];return e}}]),at);function at(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};v(this,at),this.isLoaded=!1,this.imageUrl=t,this.opt=e,this.initialize()}var lt,ut={identity:function(){return[1,0,0,0,1,0,0,0,1]},stretching:function(t){return[t,0,0,0,1,0,0,0,1]},squeezing:function(t){return[t,0,0,0,1/t,0,0,0,1]},scale:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;return[t=t||0===t?t:1,0,0,0,e=e||0===e?e:1,0,0,0,1]},scaleX:function(t){return this.scale(t)},scaleY:function(t){return this.scale(1,t)},translate:function(t,e){return[1,0,t,0,1,e,0,0,1]},rotate:function(t){t=this.radian(t);return[Math.cos(t),-Math.sin(t),0,Math.sin(t),Math.cos(t),0,0,0,1]},rotate90:function(){return[0,-1,0,1,0,0,0,0,1]},rotate180:function(){return[-1,0,0,0,-1,0,0,0,1]},rotate270:function(){return[0,1,0,-1,0,0,0,0,1]},radian:function(t){return t*Math.PI/180},skew:function(t,e){t=this.radian(t),e=this.radian(e);return[1,Math.tan(t),0,Math.tan(e),1,0,0,0,1]},skewX:function(t){t=this.radian(t);return[1,Math.tan(t),0,0,1,0,0,0,1]},skewY:function(t){t=this.radian(t);return[1,0,0,Math.tan(t),1,0,0,0,1]},shear1:function(t){return[1,-Math.tan(this.radian(t)/2),0,0,1,0,0,0,1]},shear2:function(t){return[1,0,0,Math.sin(this.radian(t)),1,0,0,0,1]}},ht={CONSTANT:ut,radian:function(t){return ut.radian(t)},multiply:function(t,e){return[t[0]*e[0]+t[1]*e[1]+t[2]*e[2],t[3]*e[0]+t[4]*e[1]+t[5]*e[2],t[6]*e[0]+t[7]*e[1]+t[8]*e[2]]},identity:function(t){return this.multiply(ut.identity(),t)},translate:function(t,e,r){return this.multiply(ut.translate(t,e),r)},rotate:function(t,e){return this.multiply(ut.rotate(t),e)},shear1:function(t,e){return this.multiply(ut.shear1(t),e)},shear2:function(t,e){return this.multiply(ut.shear2(t),e)},rotateShear:function(t,e){var r=this.shear1(t,e);return r=this.shear2(t,r),this.shear1(t,r)}},ct=0;b(lt={partial:_t,multi:Ct,merge:kt,weight:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;return t.map(function(t){return t*e})},repeat:gt,colorMatrix:function(t,e,r){var n=t[e],i=t[e+1],o=t[e+2],a=t[e+3];pt(t,e,r[0]*n+r[1]*i+r[2]*o+r[3]*a,r[4]*n+r[5]*i+r[6]*o+r[7]*a,r[8]*n+r[9]*i+r[10]*o+r[11]*a,r[12]*n+r[13]*i+r[14]*o+r[15]*a)},each:each,eachXY:eachXY,createRandomCount:function(){return[9,16,25,36,49,64,81,100].sort(function(t,e){return.5-Math.random()})[0]},createRandRange:function(t,e,r){for(var n=[],i=1;i<=r;i++){var o=Math.random()*(e-t)+t,a=Math.floor(10*Math.random())%2==0?-1:1;n.push(a*o)}n.sort();var l=Math.floor(r>>1),u=n[l];return n[l]=n[0],n[0]=u,n},createBitmap:ft,createBlurMatrix:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:3,t=Math.pow(t,2);return gt(1/t,t)},pack:function(n){return function(r,t){each(r.pixels.length,function(t,e){n(r.pixels,t,e,r.pixels[t],r.pixels[t+1],r.pixels[t+2],r.pixels[t+3])},function(){t(r)})}},packXY:function(i){return function(n,t){eachXY(n.pixels.length,n.width,function(t,e,r){i(n.pixels,t,e,r)},function(){t(n)},2<arguments.length&&void 0!==arguments[2]?arguments[2]:{})}},pixel:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},e=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return function(t){var r={},e=t.map(function(n){var i=[];Object.keys(n.context).forEach(function(t,e){i[t]="n$"+ct+++t+"$"}),Object.keys(n.rootContext).forEach(function(t,e){i[t]="r$"+ct+++t+"$",r[i[t]]=n.rootContext[t]});var t=Object.keys(n.context).filter(function(t){return"number"!=typeof n.context[t]&&"string"!=typeof n.context[t]&&(!Array.isArray(n.context[t])||"number"!=typeof n.context[t][0]&&"string"!=typeof n.context[t][0])}).map(function(t,e){return[i[t],JSON.stringify(n.context[t])].join(" = ")}),o=n.callback;return"function"==typeof n.callback&&((o=n.callback.toString().split("{")).shift(),(o=(o=o.join("{")).split("}")).pop(),o=o.join("}")),Object.keys(i).forEach(function(r){var t=i[r];"number"==typeof n.context[r]||"string"==typeof n.context[r]?o=o.replace(new RegExp("\\"+r,"g"),n.context[r]):Array.isArray(n.context[r])&&("number"==typeof n.context[r][0]||"string"==typeof n.context[r][0])?n.context[r].forEach(function(t,e){o=o.replace(new RegExp("\\"+r+"\\["+e+"\\]","g"),t)}):o=o.replace(new RegExp("\\"+r,"g"),t)}),{preCallbackString:o,preContext:t}}),n=e.map(function(t,e){return t.preContext.length?"const "+t.preContext+";":""}).join("\n\n"),t=e.map(function(t){return t.preCallbackString}).join("\n\n"),e=new Function("$pixels","$pixelIndex","$clamp","$Color"," \n    let $r = $pixels[$pixelIndex], $g = $pixels[$pixelIndex+1], $b = $pixels[$pixelIndex+2], $a = $pixels[$pixelIndex+3];\n\n    "+n+"\n\n    "+t+"\n    \n    $pixels[$pixelIndex] = $r\n    $pixels[$pixelIndex+1] = $g \n    $pixels[$pixelIndex+2] = $b   \n    $pixels[$pixelIndex+3] = $a   \n    ");return e.$preCallbackString=t,e.$preContext=n,e.rootContextObject=r,e}([{callback:t,context:e,rootContext:r}])}(t,e,r),r=function(t,e){};return r.userFunction=e,r},getBitmap:st,putBitmap:vt,radian:function(t){return ht.CONSTANT.radian(t)},convolution:function(g){var f=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],s=function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:255,o=[];return o=t.map(function(t,e){return[]}),t.forEach(function(t,e){if(0!=t)for(var r=o[e],e=n;e<=i;e++)r[e]=t*e}),o}(g);return function(t,e){var r=Math.round(Math.sqrt(g.length)),n=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=t.width+e,e=t.height+e;return{pixels:new Uint8ClampedArray(r*e*4),width:r,height:e}}(t,2*r);!function(t,e,r,n){for(var i=e.pixels.length/4,o=0,a=0,l=0,u=0,h=0,c=0,g=0;g<i;g++)l=g%e.width,u=Math.floor(g/e.width),a=n+u,(o=r+l)>t.width||a>t.height||(h=u*e.width+l<<2,c=a*t.width+o<<2,t.pixels[c]=e.pixels[h],t.pixels[1+c]=e.pixels[1+h],t.pixels[2+c]=e.pixels[2+h],t.pixels[3+c]=e.pixels[3+h])}(n,t,r,r);for(var i=ft(n.pixels.length,n.width,n.height),o=ft(t.pixels.length,t.width,t.height),a=function(t,o,i,e){var a=Math.round(Math.sqrt(t.length)),l=Math.floor(a/2),r=e?1:0,e="let r = 0, g = 0, b = 0, a = 0, scy = 0, scx =0, si = 0; ",u=[],h=[],c=[],g=[];t.forEach(function(t,e){var r=Math.floor(e/a)-l,n=e%a-l;0!=t&&(u.push("$t["+e+"][$sp[(($sy + ("+r+")) * "+i+" + ($sx + ("+n+"))) * 4]]"),h.push("$t["+e+"][$sp[(($sy + ("+r+")) * "+i+" + ($sx + ("+n+"))) * 4 + 1]]"),c.push("$t["+e+"][$sp[(($sy + ("+r+")) * "+i+" + ($sx + ("+n+"))) * 4 + 2]]"),g.push("$t["+e+"][$sp[(($sy + ("+r+")) * "+i+" + ($sx + ("+n+"))) * 4 + 3]]"))}),e+="r = "+u.join(" + ")+"; g = "+h.join(" + ")+"; b = "+c.join(" + ")+"; a = "+g.join(" + ")+";",e+="$dp[$di] = r; $dp[$di+1] = g;$dp[$di+2] = b;$dp[$di+3] = a + ("+r+")*(255-a); ";var f=new Function("$dp","$sp","$di","$sx","$sy","$t",e);return function(t,e,r,n,i){f(t,e,r,n,i,o)}}(g,s,n.width,(n.height,f)),l=t.pixels.length/4,u=0;u<l;u++){var h=u,c=h%t.width+r,h=Math.floor(h/t.width)+r;a(i.pixels,n.pixels,4*(h*n.width+c),c,h)}!function(t,e,r,n){for(var i=e.pixels.length>>2,o=0,a=0,l=0,u=0,h=0,c=0,g=0;g<i;g++){l=g%e.width,u=Math.floor(g/e.width);a=n+u,(o=r+l)>t.width||a>t.height||(h=a*t.width+o<<2,c=u*e.width+l<<2,e.pixels[c]=t.pixels[h],e.pixels[1+c]=t.pixels[1+h],e.pixels[2+c]=t.pixels[2+h],e.pixels[3+c]=t.pixels[3+h])}}(i,o,r,r),e(o)}},parseParamNumber:function(t){"string"==typeof t&&(t=(t=t.replace(/deg/,"")).replace(/px/,""));return+t},filter:yt,clamp:mt,fillColor:pt,fillPixelColor:function(t,e,r,n){pt(t,e,r[n],r[n+1],r[n+2],r[n+3])}},"multi",Ct),b(lt,"merge",kt),b(lt,"matches",bt),b(lt,"parseFilter",xt),b(lt,"partial",_t);function gt(t,e){for(var r=new Array(e),n=0;n<e;n++)r[n]=t;return r}function ft(t,e,r){return{pixels:new Uint8ClampedArray(t),width:e,height:r}}function st(t,e){return it.getBitmap(t,e)}function vt(t,e,r){return it.putBitmap(t,e,r)}var dt=/(([\w_\-]+)(\(([^\)]*)\))?)+/gi;function pt(t,e,r,n,i,o){var a;3==arguments.length&&(r=(a=arguments[2]).r,n=a.g,i=a.b,o=a.a),"number"==typeof r&&(t[e]=r),"number"==typeof n&&(t[e+1]=n),"number"==typeof i&&(t[e+2]=i),"number"==typeof o&&(t[e+3]=o)}function bt(r){var e=te.convertMatches(r),t=e.str.match(dt),n=[];if(!t)return n;var n=t.map(function(t){return{filter:t,origin:te.reverseMatches(t,e.matches)}}),i={next:0};return n=n.map(function(t){var e=r.indexOf(t.origin,i.next);return t.startIndex=e,t.endIndex=e+t.origin.length,t.arr=xt(t.origin),i.next=t.endIndex,t}).filter(function(t){return!!t.arr.length})}function xt(t){var e=te.convertMatches(t),r=e.str.match(dt);if(!r[0])return[];var n=r[0].split("("),t=n.shift(),r=[];return n.length&&(r=n.shift().split(")")[0].split(",").map(function(t){return te.reverseMatches(t,e.matches)})),[t].concat(m(r)).map(te.trim)}function mt(t){return Math.min(255,t)}function yt(t){return kt(bt(t).map(function(t){return t.arr}))}function wt(t){for(var e=0<arguments.length&&void 0!==t?t:[],r=[],n=[],i=0,o=e.length;i<o;i++){var a=e[i];a.userFunction?n.push(a):(n.length&&r.push([].concat(m(n))),r.push(a),n=[])}return n.length&&r.push([].concat(m(n))),r.forEach(function(t,e){var i;Array.isArray(t)&&(r[e]=(i=function(t){var e=t.map(function(t){return" \n            "+t.userFunction.$preContext+"\n\n            "+t.userFunction.$preCallbackString+"\n\n            $r = clamp($r); $g = clamp($g); $b = clamp($b); $a = clamp($a);\n        "}).join("\n\n"),r={clamp:mt,Color:te};t.forEach(function(t){Object.assign(r,t.userFunction.rootContextObject)});var t="const "+Object.keys(r).map(function(t){return" "+t+" = $rc."+t+" "}).join(","),n=new Function("$p","$pi","$rc"," \n    let $r = $p[$pi], $g = $p[$pi+1], $b = $p[$pi+2], $a = $p[$pi+3];\n    \n    "+t+"\n\n    "+e+"\n    \n    $p[$pi] = $r; $p[$pi+1] = $g; $p[$pi+2] = $b; $p[$pi+3] = $a;\n    ");return function(t,e){n(t,e,r)}}(t),function(t,e){for(var r=0,n=t.pixels.length;r<n;r+=4)i(t.pixels,r);e(t)}))}),r}function Ct(){for(var t=arguments.length,a=Array(t),e=0;e<t;e++)a[e]=arguments[e];var l=(a=wt(a=a.map(function(t){return makeFilter(t)}).filter(function(t){return t}))).length;return function(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},n=t,i=0;function o(){a[i].call(null,n,function(t){n=t,l<=++i?e(n):o()},r)}o()}}function kt(t){return Ct.apply(void 0,m(t))}function _t(n){for(var i=null,t=arguments.length,e=Array(1<t?t-1:0),r=1;r<t;r++)e[r-1]=arguments[r];return i=1==e.length&&"string"==typeof e[0]?yt(e[0]):kt(e),function(e,r){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};i(st(e,n),function(t){r(vt(e,t,n))},t)}}function Tt(t){return+(t="string"==typeof t?(t=t.replace(/deg/,"")).replace(/px/,""):t)}function At(t,e){var r=1<arguments.length&&void 0!==e?e:1;return t.map(function(t){return t*r})}var Mt=0;function Et(){return[].concat(Array.prototype.slice.call(arguments))}function $t(t){return{type:"convolution",length:t.length,content:t}}function Rt(t,e){return{type:"shader",index:Mt,options:e,content:"\n        if (u_filterIndex == "+Mt+++".0) {\n            "+t+"\n        }\n    "}}function It(t){return"\n    \n    if (u_kernelSelect == "+t+".0) {\n        vec4 colorSum = "+(n=t,i=Math.sqrt(n),o=Math.floor(i/2),[].concat(m(Array(n))).map(function(t,e){var r=Math.floor(e/i)-o;return"texture(u_image, v_texCoord + onePixel * vec2("+(e%i-o)+", "+r+")) * u_kernel"+n+"["+e+"]"}).join(" + \n"))+"; \n\n        outColor = vec4((colorSum / u_kernel"+t+"Weight).rgb, 1);\n        \n    }\n    ";var n,i,o}function Bt(t){return"vec4("+(t=[t.r/255,t.g/255,t.b/255,t.a||0].map(St))+")"}function St(t){return t==Math.floor(t)?t+".0":t}function Ft(){return $t(At([1,2,1,2,4,2,1,2,1],Tt(0<arguments.length&&void 0!==arguments[0]?arguments[0]:1)*(1/16)))}function Ot(){return $t([1,4,6,4,1,4,16,24,16,4,6,24,36,24,6,4,16,24,16,4,1,4,6,4,1])}function Ut(){return $t([5,5,5,-3,0,-3,-3,-3,-3])}function Pt(){return $t([5,-3,-3,5,0,-3,5,-3,-3])}function Gt(){return $t([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,24,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1])}function Dt(){return $t([1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1])}function Lt(){return $t([1,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,1])}function jt(){return $t([1,0,0,0,1,0,0,0,1,0,1,0,0,1,0,0,1,0,0,0,1,0,1,0,1,0,0,0,0,0,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,0,0,0,0,0,1,0,1,0,1,0,0,0,1,0,0,1,0,0,1,0,1,0,0,0,1,0,0,0,1])}function Nt(){return $t([-1,-2,-1,0,0,0,1,2,1])}function Ht(){return $t([-1,0,1,-2,0,2,-1,0,1])}function Xt(){return $t(At([1,4,6,4,1,4,16,24,16,4,6,24,-476,24,6,4,16,24,16,4,1,4,6,4,1],-1/256))}function zt(){var t=[0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,6<arguments.length&&void 0!==arguments[6]?arguments[6]:0,7<arguments.length&&void 0!==arguments[7]?arguments[7]:0,8<arguments.length&&void 0!==arguments[8]?arguments[8]:0,9<arguments.length&&void 0!==arguments[9]?arguments[9]:0,10<arguments.length&&void 0!==arguments[10]?arguments[10]:0,11<arguments.length&&void 0!==arguments[11]?arguments[11]:0,12<arguments.length&&void 0!==arguments[12]?arguments[12]:0,13<arguments.length&&void 0!==arguments[13]?arguments[13]:0,14<arguments.length&&void 0!==arguments[14]?arguments[14]:0,15<arguments.length&&void 0!==arguments[15]?arguments[15]:0].map(St);return Rt("\n\n        outColor = vec4(\n            "+t[0]+" * pixelColor.r + "+t[1]+" * pixelColor.g + "+t[2]+" * pixelColor.b + "+t[3]+" * pixelColor.a,\n            "+t[4]+" * pixelColor.r + "+t[5]+" * pixelColor.g + "+t[6]+" * pixelColor.b + "+t[7]+" * pixelColor.a,\n            "+t[8]+" * pixelColor.r + "+t[9]+" * pixelColor.g + "+t[10]+" * pixelColor.b + "+t[11]+" * pixelColor.a,\n            "+t[12]+" * pixelColor.r + "+t[13]+" * pixelColor.g + "+t[14]+" * pixelColor.b + "+t[15]+" * pixelColor.a\n        ); \n    ")}function qt(){return Rt("\n        float c = ( (pixelColor.r * 0.2126 + pixelColor.g * 0.7152 + pixelColor.b * 0.0722) ) >= "+St(Tt(0<arguments.length&&void 0!==arguments[0]?arguments[0]:1))+" ? 1.0 : 0.0;\n\n        outColor = vec4(c, c, c, pixelColor.a);\n    ")}var Yt=x({},{blur:function(){return $t([1,1,1,1,1,1,1,1,1])},normal:function(){return $t([0,0,0,0,1,0,0,0,0])},emboss:function(){var t;return $t([-2*(t=Tt(t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:4)),-t,0,-t,1,t,0,t,2*t])},gaussianBlur:Ft,"gaussian-blur":Ft,gaussianBlur5x:Ot,"gaussian-blur-5x":Ot,grayscale2:function(){return $t([.3,.3,.3,0,0,.59,.59,.59,0,0,.11,.11,.11,0,0,0,0,0,0,0,0,0,0,0,0])},kirschHorizontal:Ut,"kirsch-horizontal":Ut,kirschVertical:Pt,"kirsch-vertical":Pt,laplacian:function(){return $t([-1,-1,-1,-1,8,-1,-1,-1,-1])},laplacian5x:Gt,"laplacian-5x":Gt,motionBlur:Dt,"motion-blur":Dt,motionBlur2:Lt,"motion-blur-2":Lt,motionBlur3:jt,"motion-blur-3":jt,negative:function(){return $t([-1,0,0,0,0,0,-1,0,0,0,0,0,-1,0,0,0,0,0,1,0,1,1,1,1,1])},sepia2:function(){return $t([.393,.349,.272,0,0,.769,.686,.534,0,0,.189,.168,.131,0,0,0,0,0,0,0,0,0,0,0,0])},sharpen:function(){return $t([0,-1,0,-1,5,-1,0,-1,0])},sobelHorizontal:Nt,"sobel-horizontal":Nt,sobelVertical:Ht,"sobel-vertical":Ht,transparency:function(){return $t([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,.3,0,0,0,0,0,1])},unsharpMasking:Xt,"unsharp-masking":Xt},{bitonal:function(t,e){var r=St(2<arguments.length&&void 0!==arguments[2]?arguments[2]:.5),t=Bt(te.parse(t));return Rt("\n        if ((pixelColor.r + pixelColor.g + pixelColor.b) > "+r+") {\n            outColor = vec4("+Bt(te.parse(e))+".rgb, pixelColor.a);\n        } else {\n            outColor = vec4("+t+".rgb, pixelColor.a);\n        }\n    ")},brightness:function(){return Rt("\n        outColor = pixelColor + ("+St(Tt(0<arguments.length&&void 0!==arguments[0]?arguments[0]:1))+");\n    ")},brownie:function(){return zt(.5997023498159715,.34553243048391263,-.2708298674538042,0,-.037703249837783157,.8609577587992641,.15059552388459913,0,.24113635128153335,-.07441037908422492,.44972182064877153,0,0,0,0,1)},clip:function(){var t=St(Tt(0<arguments.length&&void 0!==arguments[0]?arguments[0]:0));return Rt("\n        outColor = vec4(\n            (pixelColor.r > 1.0 - "+t+") ? 1.0 : 0.0,\n            (pixelColor.g > 1.0 - "+t+") ? 1.0 : 0.0,\n            (pixelColor.b > 1.0 - "+t+") ? 1.0 : 0.0,\n            pixelColor.a \n        );\n    ")},chaos:function(){return Rt("\n        vec2 st = pixelColor.st;\n        st *= "+St(Tt(0<arguments.length&&void 0!==arguments[0]?arguments[0]:10))+";\n        \n        vec2 ipos = floor(st);  // get the integer coords\n\n        vec3 color = vec3(random( ipos ));\n\n        outColor = vec4(color, pixelColor.a);\n    ")},contrast:function(){return Rt("\n        outColor = pixelColor * "+St(Tt(0<arguments.length&&void 0!==arguments[0]?arguments[0]:1))+";\n    ")},gamma:function(){var t=St(Tt(0<arguments.length&&void 0!==arguments[0]?arguments[0]:1));return Rt("\n        outColor = vec4(pow(pixelColor.r, "+t+"), pow(pixelColor.g, "+t+"), pow(pixelColor.b, "+t+"), pixelColor.a );\n    ")},gradient:function(){var t=(t=1===(t=[].concat(Array.prototype.slice.call(arguments))).length&&"string"==typeof t[0]?te.convertMatchesArray(t[0]):t).map(function(t){return t}).join(", "),e=te.parseGradient(t);e[0][1]=0,e[e.length-1][1]=1;for(var r=[],n=0,i=(e=e.map(function(t){var e=te.parse(t[0]);return[{r:e.r,g:e.g,b:e.b,a:e.a},t[1]]})).length;n<i-1;n++){var o=e[n],a=e[n+1],l=Bt(o[0]),u=Bt(a[0]),o=St(o[1]),a=St(a[1]);r.push("\n            if ("+o+" <= rate && rate < "+a+") {\n                outColor = mix("+l+", "+u+", (rate - "+o+")/("+a+" - "+o+"));\n            }\n        ")}return Rt("\n        float rate = (pixelColor.r * 0.2126 + pixelColor.g * 0.7152 + pixelColor.b * 0.0722); \n\n        "+r.join("\n")+"        \n    ")},grayscale:function(){var t=Tt(0<arguments.length&&void 0!==arguments[0]?arguments[0]:1);return zt(.2126+.7874*(1-(t=1<t?1:t)),.7152-.7152*(1-t),.0722-.0722*(1-t),0,.2126-.2126*(1-t),.7152+.2848*(1-t),.0722-.0722*(1-t),0,.2126-.2126*(1-t),.7152-.7152*(1-t),.0722+.9278*(1-t),0,0,0,0,1)},hue:function(){return Rt("\n        vec3 hsv = rgb2hsv(pixelColor.rgb);\n        hsv.x += "+St(Tt(0<arguments.length&&void 0!==arguments[0]?arguments[0]:1))+";\n        outColor = vec4(hsv2rgb(hsv).rgb, pixelColor.a);\n    ")},invert:function(){var t=St(Tt(0<arguments.length&&void 0!==arguments[0]?arguments[0]:1));return Rt("\n        outColor = vec4(\n            (1.0 - pixelColor.r) * "+t+",\n            (1.0 - pixelColor.g) * "+t+",\n            (1.0 - pixelColor.b) * "+t+",\n            pixelColor.a\n        );\n    ")},kodachrome:function(){return zt(1.1285582396593525,-.3967382283601348,-.03992559172921793,0,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,0,0,0,1)},matrix:zt,noise:function(){var t=Math.abs(Tt(0<arguments.length&&void 0!==arguments[0]?arguments[0]:1)),e=St(-t);return Rt("\n        float rnd = "+e+" + random( pixelColor.st ) * ("+St(t)+" - "+e+");\n\n        outColor = vec4(pixelColor.rgb + rnd, 1.0);\n    ")},opacity:function(){return Rt("\n        outColor = vec4(pixelColor.rgb, pixelColor.a * "+St(Tt(0<arguments.length&&void 0!==arguments[0]?arguments[0]:1))+");\n    ")},polaroid:function(){return zt(1.438,-.062,-.062,0,-.122,1.378,-.122,0,-.016,-.016,1.483,0,0,0,0,1)},saturation:function(){var t=1-Math.abs(Tt(0<arguments.length&&void 0!==arguments[0]?arguments[0]:0));return zt(t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,t)},sepia:function(){var t=Tt(0<arguments.length&&void 0!==arguments[0]?arguments[0]:1);return zt(.393+.607*(1-(t=1<t?1:t)),.769-.769*(1-t),.189-.189*(1-t),0,.349-.349*(1-t),.686+.314*(1-t),.168-.168*(1-t),0,.272-.272*(1-t),.534-.534*(1-t),.131+.869*(1-t),0,0,0,0,1)},shade:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;return Rt("\n        outColor = vec4(\n            pixelColor.r * "+St(Tt(t)/255)+",\n            pixelColor.g * "+St(Tt(e)/255)+",\n            pixelColor.b * "+St(Tt(r)/255)+",\n            pixelColor.a\n        );\n    ")},shift:function(){return zt(1.438,-.062,-.062,0,-.122,1.378,-.122,0,-.016,-.016,1.483,0,0,0,0,1)},solarize:function(t,e,r){return Rt("\n        outColor = vec4(\n            (pixelColor.r < "+St(Tt(t))+") ? 1.0 - pixelColor.r: pixelColor.r,\n            (pixelColor.g < "+St(Tt(e))+") ? 1.0 - pixelColor.g: pixelColor.g,\n            (pixelColor.b < "+St(Tt(r))+") ? 1.0 - pixelColor.b: pixelColor.b,\n            pixelColor.a\n        );\n    ")},technicolor:function(){return zt(1.9125277891456083,-.8545344976951645,-.09155508482755585,0,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-.231103377548616,-.7501899197440212,1.847597816108189,0,0,0,0,1)},threshold:function(){return qt(0<arguments.length&&void 0!==arguments[0]?arguments[0]:200,1<arguments.length&&void 0!==arguments[1]?arguments[1]:100,!1)},"threshold-color":qt,tint:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;return Rt("\n        outColor = vec4(\n            pixelColor.r += (1 - pixelColor.r) * "+Tt(t)+",\n            pixelColor.g += (1 - pixelColor.g) * "+Tt(e)+",\n            pixelColor.b += (1 - pixelColor.b) * "+Tt(r)+",\n            pixelColor.a\n        );\n    ")}},{kirsch:function(){return Et("kirsch-horizontal kirsch-vertical")},sobel:function(){return Et("sobel-horizontal sobel-vertical")},vintage:function(){return Et("brightness(0.15) saturation(-0.2) gamma(1.8)")}}),Wt=0;function Vt(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{width:"400px",height:"300px"};v(this,Vt),this.img=t.img,this.width=parseFloat(this.img.width||t.width||"400px"),this.height=parseFloat(this.img.height||t.height||"300px"),this.init()}var Kt={GLCanvas:(d(Vt,[{key:"resize",value:function(){this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.style.width=this.width+"px",this.canvas.style.height=this.height+"px",this.viewport()}},{key:"clear",value:function(){var t=this.gl;t.clearColor(0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,3<arguments.length&&void 0!==arguments[3]?arguments[3]:0),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}},{key:"viewport",value:function(t,e,r,n){var i=this.gl;i.viewport(t||0,e||0,r||i.canvas.width,n||i.canvas.height)}},{key:"initCanvas",value:function(t,e){if(this.canvas=document.createElement("canvas"),this.gl=this.canvas.getContext("webgl2"),!this.gl)throw new Error("you need webgl2 support");this.program=this.createProgram(t,e),this.resize(),this.initBuffer()}},{key:"draw",value:function(){var t=this.gl;t.drawArrays(t[0<arguments.length&&void 0!==arguments[0]?arguments[0]:"TRIANGLES"],1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,2<arguments.length&&void 0!==arguments[2]?arguments[2]:6)}},{key:"triangles",value:function(){this.draw("TRIANGLES",0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,1<arguments.length&&void 0!==arguments[1]?arguments[1]:6)}},{key:"uniform2f",value:function(){for(var t,e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];var i=r.shift();(t=this.gl).uniform2f.apply(t,[this.locations[i]].concat(r))}},{key:"uniform1f",value:function(){for(var t,e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];var i=r.shift();(t=this.gl).uniform1f.apply(t,[this.locations[i]].concat(r))}},{key:"uniform1fv",value:function(){for(var t,e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];var i=r.shift();(t=this.gl).uniform1fv.apply(t,[this.locations[i]].concat(r))}},{key:"uniform1i",value:function(){for(var t,e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];var i=r.shift();(t=this.gl).uniform1i.apply(t,[this.locations[i]].concat(r))}},{key:"useProgram",value:function(){this.gl.useProgram(this.program)}},{key:"bindBuffer",value:function(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"STATIC_DRAW",n=this.gl;this.buffers[t]||(this.buffers[t]=n.createBuffer()),n.bindBuffer(n.ARRAY_BUFFER,this.buffers[t]),e&&n.bufferData(n.ARRAY_BUFFER,new Float32Array(e),n[r])}},{key:"enable",value:function(t){this.gl.enableVertexAttribArray(this.locations[t])}},{key:"location",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"attribute";"attribute"===e?this.locations[t]=this.gl.getAttribLocation(this.program,t):"uniform"===e&&(this.locations[t]=this.gl.getUniformLocation(this.program,t))}},{key:"a",value:function(t){return this.location(t)}},{key:"u",value:function(t){return this.location(t,"uniform")}},{key:"pointer",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"FLOAT",r=this.gl;r.vertexAttribPointer(this.locations[t],2<arguments.length&&void 0!==arguments[2]?arguments[2]:2,r[e],3<arguments.length&&void 0!==arguments[3]&&arguments[3],4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,5<arguments.length&&void 0!==arguments[5]?arguments[5]:0)}},{key:"bufferData",value:function(){var t=this.gl;t.bufferData(t.ARRAY_BUFFER,new Float32Array(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]),t.STATIC_DRAW)}},{key:"isPowerOf2",value:function(t){return 0==(t&t-1)}},{key:"bindTexture",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"RGBA",i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"RGBA",o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"UNSIGNED_BYTE",a=this.gl;1!=arguments.length?(this.textures[t]||(this.textures[t]=a.createTexture()),this.textureIndex[t]=Wt++,a.bindTexture(a.TEXTURE_2D,this.textures[t]),this.setTextureParameter(),a.texImage2D(a.TEXTURE_2D,r,a[n],a[i],a[o],e.newImage||e)):a.bindTexture(a.TEXTURE_2D,this.textures[t])}},{key:"bindColorTexture",value:function(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:256,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"RGBA",a=6<arguments.length&&void 0!==arguments[6]?arguments[6]:"RGBA",l=7<arguments.length&&void 0!==arguments[7]?arguments[7]:"UNSIGNED_BYTE",u=this.gl;this.textures[t]||(this.textures[t]=u.createTexture()),this.textureIndex[t]=Wt++,u.bindTexture(u.TEXTURE_2D,this.textures[t]),this.setTextureParameter(),u.texImage2D(u.TEXTURE_2D,i,u[o],r,n,0,u[a],u[l],new Uint8Array(e))}},{key:"bindEmptyTexture",value:function(t,e,r){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"RGBA",o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"RGBA",a=6<arguments.length&&void 0!==arguments[6]?arguments[6]:"UNSIGNED_BYTE",l=this.gl;this.textures[t]||(this.textures[t]=l.createTexture()),this.textureIndex[t]=Wt++,l.bindTexture(l.TEXTURE_2D,this.textures[t]),this.setTextureParameter();l.texImage2D(l.TEXTURE_2D,n,l[i],e,r,0,l[o],l[a],null)}},{key:"setTextureParameter",value:function(){var t=this.gl;t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST)}},{key:"bindFrameBufferWithTexture",value:function(t,e,r,n){this.bindEmptyTexture(e,r,n),this.bindFrameBuffer(t,e)}},{key:"enumToString",value:function(t){var e,r=this.gl;if(0===t)return"NONE";for(e in r)if(r[e]===t)return e;return"0x"+t.toString(16)}},{key:"bindFrameBuffer",value:function(t){var e,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=this.gl;1!==arguments.length?(this.framebuffers[t]||(this.framebuffers[t]=n.createFramebuffer()),n.bindFramebuffer(n.FRAMEBUFFER,this.framebuffers[t]),e=n.COLOR_ATTACHMENT0,n.framebufferTexture2D(n.FRAMEBUFFER,e,n.TEXTURE_2D,this.textures[r],0),n.checkFramebufferStatus(n.FRAMEBUFFER),n.FRAMEBUFFER_COMPLETE):n.bindFramebuffer(n.FRAMEBUFFER,null==t?null:this.framebuffers[t])}},{key:"bindVA",value:function(){var t=this.gl;this.vao||(this.vao=t.createVertexArray()),t.bindVertexArray(this.vao)}},{key:"bindAttr",value:function(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"STATIC_DRAW",n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:2;this.bindBuffer(t,e,r),this.enable(t),this.pointer(t,"FLOAT",n)}},{key:"initBuffer",value:function(){var t=this.canvas,e=t.width,t=t.height;this.a("a_position"),this.a("a_texCoord"),this.u("u_resolution"),this.u("u_image"),this.u("u_flipY"),this.u("u_kernelSelect"),this.u("u_filterIndex"),this.u("u_kernel9[0]"),this.u("u_kernel9Weight"),this.u("u_kernel25[0]"),this.u("u_kernel25Weight"),this.u("u_kernel49[0]"),this.u("u_kernel49Weight"),this.u("u_kernel81[0]"),this.u("u_kernel81Weight"),this.bindVA(),this.bindAttr("a_position",[0,0,e,0,0,t,0,t,e,0,e,t],"STATIC_DRAW",2),this.bindAttr("a_texCoord",[0,0,1,0,0,1,0,1,1,0,1,1],"STATIC_DRAW",2),this.bindTexture("u_image",this.img),this.bindFrameBufferWithTexture("frame_buffer_0","img_texture_0",e,t),this.bindFrameBufferWithTexture("frame_buffer_1","img_texture_1",e,t)}},{key:"activeTexture",value:function(){var t=this.gl;t.activeTexture(t.TEXTURE0+(0<arguments.length&&void 0!==arguments[0]?arguments[0]:0))}},{key:"drawFilter",value:function(){var r=this,t=this.gl;this.resize(),this.clear(),this.useProgram(),this.bindVA(),this.activeTexture(0),this.bindTexture("u_image"),this.uniform1i("u_image",0),this.uniform1f("u_flipY",1);var t=t.canvas,n=t.width,i=t.height;this.eachFilter(function(t,e){r.bindFrameBuffer("frame_buffer_"+e%2),r.uniform2f("u_resolution",n,i),r.viewport(0,0,n,i),r.effectFilter(t),r.bindTexture("img_texture_"+e%2)}),this.uniform1f("u_flipY",-1),this.bindFrameBuffer(null),this.uniform2f("u_resolution",n,i),this.viewport(0,0,n,i),this.clear(),this.effectFilter("normal")}},{key:"effectFilter",value:function(t){"convolution"==(t="string"==typeof t?(Yt[t]||Yt.normal).call(Yt):t).type?(this.uniform1f("u_kernelSelect",t.length),this.uniform1f("u_filterIndex",-1),this.uniform1fv("u_kernel"+t.length+"[0]",t.content),this.uniform1f("u_kernel"+t.length+"Weight",this.computeKernelWeight(t.content))):(this.uniform1f("u_kernelSelect",-1),this.uniform1f("u_filterIndex",t.index)),this.triangles(0,6)}},{key:"computeKernelWeight",value:function(t){t=t.reduce(function(t,e){return t+e});return t<=0?1:t}},{key:"createProgram",value:function(t,e){var r=this.gl,n=r.createProgram();if(this.vertexShader=this.createVertexShader(t),this.fragmentShader=this.createFragmentShader(e),r.attachShader(n,this.vertexShader),r.attachShader(n,this.fragmentShader),r.linkProgram(n),r.getProgramParameter(n,r.LINK_STATUS))return n;console.error(r.getProgramInfoLog(n)),r.deleteProgram(n)}},{key:"createShader",value:function(t,e){var r=this.gl,t=r.createShader(t);if(r.shaderSource(t,e),r.compileShader(t),r.getShaderParameter(t,r.COMPILE_STATUS))return t;console.error(r.getShaderInfoLog(t)),r.deleteShader(t)}},{key:"createVertexShader",value:function(t){var e=this.gl;return this.createShader(e.VERTEX_SHADER,t)}},{key:"createFragmentShader",value:function(t){var e=this.gl;return this.createShader(e.FRAGMENT_SHADER,t)}},{key:"eachFilter",value:function(t){this.filterList.forEach(t)}},{key:"init",value:function(){this.locations={},this.buffers={},this.framebuffers={},this.textures={},this.textureIndex={},this.hasTexParameter={}}},{key:"destroy",value:function(){var t=this.gl;this.init(),t.deleteProgram(this.program)}},{key:"filter",value:function(t,e){var r,n;this.filterList=t,this.initCanvas("#version 300 es \n\n        in vec2 a_position;\n        in vec2 a_texCoord; \n\n        uniform vec2 u_resolution;\n        uniform float u_flipY;\n\n        out vec2 v_texCoord; \n\n        void main() {\n            vec2 zeroToOne = a_position / u_resolution;\n\n            vec2 zeroToTwo = zeroToOne * 2.0;\n\n            vec2 clipSpace = zeroToTwo - 1.0;\n\n            gl_Position = vec4(clipSpace * vec2(1, u_flipY), 0, 1);\n\n            v_texCoord = a_texCoord;\n\n        }\n    ",(r=this.filterList,t=r.filter(function(t){return"shader"==t.type}).map(function(t){return t.content}).join("\n\n"),n={9:!0},r.filter(function(t){return"convolution"==t.type}).forEach(function(t){n[t.length]=!0}),"#version 300 es\n\n    precision highp int;\n    precision mediump float;\n    \n    uniform sampler2D u_image;\n\n    // 3 is 3x3 matrix kernel \n    uniform float u_kernelSelect;\n    uniform float u_filterIndex;\n\n    uniform float u_kernel9[9];\n    uniform float u_kernel9Weight;\n    uniform float u_kernel25[25];\n    uniform float u_kernel25Weight;\n    uniform float u_kernel49[49];\n    uniform float u_kernel49Weight;\n    uniform float u_kernel81[81];\n    uniform float u_kernel81Weight;    \n\n    in vec2 v_texCoord;\n    \n    out vec4 outColor;\n\n    float random (vec2 st) {\n        return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);\n    } \n\n    // \n    vec3 rgb2hsv(vec3 c)\n    {\n        vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n        vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n        vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n\n        float d = q.x - min(q.w, q.y);\n        float e = 1.0e-10;\n        return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n    }\n\n    vec3 hsv2rgb(vec3 c)\n    {\n        vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n        vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n        return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n    }\n    \n    void main() {\n        vec4 pixelColor = texture(u_image, v_texCoord);\n        vec2 onePixel = vec2(1) / vec2(textureSize(u_image, 0));                \n\n        "+t+"\n\n        "+Object.keys(n).map(function(t){return It(+t)}).join("\n")+"\n\n    }")),this.drawFilter(),"function"==typeof e&&e(this)}}]),Vt)},d={filter:function(t,e,r,n){var i=new Kt.GLCanvas({width:n.width||t.width,height:n.height||t.height,img:t});i.filter(function r(t){var e=[];"string"==typeof t?e=bt(t):Array.isArray(t)&&(e=t);var n=[];e.forEach(function(t){var e=t.arr[0];filters[e]&&("convolution"==(t=Zt(t)).type||"shader"==t.type?n.push(t):t.forEach(function(t){n=n.concat(r(t))}))});return n}(e),function(){"function"==typeof r&&r(i)})}};function Zt(t){var e=t.arr[0],e=filters[e],t=t.arr;return t.shift(),e.apply(this,t)}var Jt=x({},Kt,d);function Qt(t,e,r){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{frameTimer:"full"},i=new ot(t);i.loadImage(function(){i.toArray(e,function(t){"function"==typeof r&&r(t)},n)})}var te=x({},t,e,Z,E,z,U,P,X,s,N,{palette:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:6,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"hex";return(t=t.length>e?rt(t,e):t).map(function(t){return g(t,r)})},ImageToCanvas:function(t,e,r){Qt(t,e,r,Object.assign({returnTo:"canvas"},3<arguments.length&&void 0!==arguments[3]?arguments[3]:{frameTimer:"full"}))},ImageToHistogram:function(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{width:200,height:100},n=new ot(t);n.loadImage(function(){it.createHistogram(r.width||200,r.height||100,n.toHistogram(r),function(t){"function"==typeof e&&e(t.toDataURL("image/png"))},r)})},ImageToRGB:function(t){var e,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=arguments[2];n?n&&(e=new ot(t,r)).loadImage(function(){"function"==typeof n&&n(e.toRGB())}):(e=new ot(t)).loadImage(function(){"function"==typeof r&&r(e.toRGB())})},ImageToURL:Qt,GLToCanvas:function(t,e,r){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},i=new ot(t);i.load(function(){Jt.filter(i.newImage,e,function(t){"function"==typeof r&&r(t)},n)})},histogram:function(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},n=new ot(t);n.loadImage(function(){"function"==typeof e&&e(n.toHistogram(r))})},histogramToPoints:function(t){for(var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:.2,r=[],n=0;n<t.length;n++){var i,o,a,l=t[n];0!=n?n!=t.length-1?(a=t[n-1],(o=t[n+1])[1],a[1],o[0],a[0],i=[a[0]+(o[0]-a[0])*e,a[1]+(o[1]-a[1])*e],i=[[].concat(m(a)),[].concat(i)],a=Math.sqrt(Math.pow(l[0]-a[0],2)+Math.pow(l[1]-a[1],2))/Math.sqrt(Math.pow(o[0]-l[0],2)+Math.pow(o[1]-l[1],2)),o=i[0][0]+(i[1][0]-i[0][0])*a,a=i[0][1]+(i[1][1]-i[0][1])*a,i[0][0]+=l[0]-o,i[0][1]+=l[1]-a,i[1][0]+=l[0]-o,i[1][1]+=l[1]-a,r[n]=i):r[n]=[]:r[n]=[]}return r}}),ee=[{rgb:"#ff0000",start:0},{rgb:"#ffff00",start:.17},{rgb:"#00ff00",start:.33},{rgb:"#00ffff",start:.5},{rgb:"#0000ff",start:.67},{rgb:"#ff00ff",start:.83},{rgb:"#ff0000",start:1}];!function(){for(var t=0,e=ee.length;t<e;t++){var r=ee[t],n=te.parse(r.rgb);r.r=n.r,r.g=n.g,r.b=n.b}}();N={colors:ee,checkHueColor:function(t){for(var e,r,n=0;n<ee.length;n++)if(ee[n].start>=t){e=ee[n-1],r=ee[n];break}return e&&r?te.interpolateRGB(e,r,(t-e.start)/(r.start-e.start)):ee[0].rgb}};return x({},{Color:te,HueColor:N,ColorNames:u,GL:Jt,Canvas:it,ImageLoader:ot})}();
